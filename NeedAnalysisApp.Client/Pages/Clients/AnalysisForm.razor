@page "/client/analysis/{AssessmentId}"

<MudPaper Class="mt-3" Style="@($"color:{Colors.Indigo.Default};background:{Colors.Indigo.Lighten5};")">

    <MudTabs @ref=tabs Centered="true" Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Color="Color.Primary">

        <MudTabPanel Text="Who we are" @ref="WhoWeAreTab">

            @foreach (var (question, index) in Questions.Where(x => x.GeneralLookUp_SectionTypeId == 6).OrderBy(x => x.DisplayOrder).Select((question, index) => (question, index)))
            {
                if (question.GeneralLookUp_QuestionTypeId == 5)
                {
                    <MudText Class="mt-5" Align="Align.Center" Typo="Typo.h6">@question.Value</MudText>
                }
                if (question.GeneralLookUp_QuestionTypeId == 1 || question.GeneralLookUp_QuestionTypeId == 2)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>

                            <MudItem Class="row">
                                <MudRadioGroup Class="ms-2 row" T="string" Value="@GetSelectedValue(question.UniqueId)" ValueChanged="(x) => OnSelectedOptionChanged(x, question.UniqueId)">
                                    @foreach (var (option, optionIndex) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, optionIndex) => (option, optionIndex)))
                                    {
                                        <MudItem Class="col-6">
                                            @(optionIndex + 1). <MudRadio Color="Color.Primary" Value="@option.Value">@option.Value</MudRadio>
                                        </MudItem>
                                    }
                                </MudRadioGroup>
                            </MudItem>

                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 3)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudTextField @bind-Value="@option.Value" Lines="3"></MudTextField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 4)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudNumericField @bind-Value="@option.Value"></MudNumericField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
            }

            <MudItem Class="mt-2 d-flex justify-content-end">
                @if (IsPreview)
                {
                    <MudButton OnClick="ClosePreview" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Close" Color="Color.Warning">Close</MudButton>
                }
                <MudButton Class="ms-2" OnClick="(e)=> OnNextClick(WhatWeDoTab)" Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.NavigateNext" Color="Color.Primary">Next</MudButton>
            </MudItem>

        </MudTabPanel>

        <MudTabPanel Text="What we do" @ref="WhatWeDoTab">
            @foreach (var (question, index) in Questions.Where(x => x.GeneralLookUp_SectionTypeId == 7).OrderBy(x => x.DisplayOrder).Select((question, index) => (question, index)))
            {
                if (question.GeneralLookUp_QuestionTypeId == 5)
                {
                    <MudText Class="mt-5" Align="Align.Center" Typo="Typo.h6">@question.Value</MudText>
                }
                if (question.GeneralLookUp_QuestionTypeId == 1 || question.GeneralLookUp_QuestionTypeId == 2)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                <MudRadioGroup Class="ms-2 row" T="string" Value="@GetSelectedValue(question.UniqueId)" ValueChanged="(x) => OnSelectedOptionChanged(x, question.UniqueId)">
                                    @foreach (var (option, optionIndex) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, optionIndex) => (option, optionIndex)))
                                    {
                                        <MudItem Class="col-6">
                                            @(optionIndex + 1). <MudRadio Color="Color.Primary" Value="@option.Value">@option.Value</MudRadio>
                                        </MudItem>
                                    }
                                </MudRadioGroup>
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 3)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudTextField @bind-Value="@option.Value" Lines="3"></MudTextField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 4)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudNumericField @bind-Value="@option.Value"></MudNumericField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
            }

            <MudItem Class="mt-2 d-flex justify-content-end">
                @if (IsPreview)
                {
                    <MudButton OnClick="ClosePreview" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Close" Color="Color.Warning">Close</MudButton>
                }
                <MudButton Class="ms-2" OnClick="(e)=> OnNextClick(WhoWeAreTab)" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.NavigateBefore" Color="Color.Default">Previous</MudButton>
                <MudButton Class="ms-2" OnClick="(e)=> OnNextClick(HowWeDoItTab)" Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.NavigateNext" Color="Color.Primary">Next</MudButton>
            </MudItem>
        </MudTabPanel>

        <MudTabPanel Text="How we do it" @ref="HowWeDoItTab">
            @foreach (var (question, index) in Questions.Where(x => x.GeneralLookUp_SectionTypeId == 8).OrderBy(x => x.DisplayOrder).Select((question, index) => (question, index)))
            {
                if (question.GeneralLookUp_QuestionTypeId == 5)
                {
                    <MudText Class="mt-5" Align="Align.Center" Typo="Typo.h6">@question.Value</MudText>
                }
                if (question.GeneralLookUp_QuestionTypeId == 1 || question.GeneralLookUp_QuestionTypeId == 2)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                <MudRadioGroup Class="ms-2 row" T="string" Value="@GetSelectedValue(question.UniqueId)" ValueChanged="(x) => OnSelectedOptionChanged(x, question.UniqueId)">
                                    @foreach (var (option, optionIndex) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, optionIndex) => (option, optionIndex)))
                                    {
                                        <MudItem Class="col-6">
                                            @(optionIndex + 1). <MudRadio Color="Color.Primary" Value="@option.Value">@option.Value</MudRadio>
                                        </MudItem>
                                    }
                                </MudRadioGroup>
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 3)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudTextField @bind-Value="@option.Value" Lines="3"></MudTextField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
                if (question.GeneralLookUp_QuestionTypeId == 4)
                {
                    <MudGrid Class="mt-5">
                        <MudItem xs="12">
                            <MudText>
                                @(index + 1). @question.Value
                                <MudIcon Icon="@Icons.Material.Outlined.Info" Title="@question.Description" />
                            </MudText>
                            <MudItem Class="row">
                                @foreach (var (option, index) in question.Options.OrderBy(x => x.DisplayOrder).Select((option, index) => (option, index)))
                                {
                                    <MudItem Class="col-12">
                                        <MudNumericField @bind-Value="@option.Value"></MudNumericField>
                                    </MudItem>
                                }
                            </MudItem>
                        </MudItem>
                    </MudGrid>
                }
            }

            <MudItem Class="mt-2 d-flex justify-content-end">
                @if (IsPreview)
                {
                    <MudButton OnClick="ClosePreview" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Close" Color="Color.Warning">Close</MudButton>
                }
                <MudButton Class="ms-2" OnClick="(e)=> OnNextClick(WhatWeDoTab)" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.NavigateBefore" Color="Color.Default">Previous</MudButton>
                <MudButton Class="ms-2" OnClick="(e)=> OnSubmitClick()" Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.NavigateNext" Color="Color.Primary">Analysis</MudButton>
            </MudItem>
        </MudTabPanel>

    </MudTabs>

</MudPaper>